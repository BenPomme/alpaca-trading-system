 name: Update Trading Dashboard Data

  on:
    schedule:
      # Run every 10 minutes during market hours (9:30 
  AM - 4:00 PM ET = 13:30-20:00 UTC)
      - cron: '*/10 13-20 * * 1-5'  # Mon-Fri every 10 
  minutes during market hours
      # Run every 30 minutes outside market hours for 
  crypto tracking
      - cron: '*/30 * * * *'  # Every 30 minutes for 
  crypto (24/7)
    workflow_dispatch: # Allow manual trigger

  permissions:
    contents: write

  jobs:
    update-dashboard:
      runs-on: ubuntu-latest

      steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install alpaca-trade-api

      - name: Create directories
        run: |
          mkdir -p data
          mkdir -p docs/api

      - name: Generate dashboard data
        env:
          ALPACA_PAPER_API_KEY: ${{
  secrets.ALPACA_PAPER_API_KEY }}
          ALPACA_PAPER_SECRET_KEY: ${{
  secrets.ALPACA_PAPER_SECRET_KEY }}
        run: |
          echo "ğŸ”„ Generating dashboard data..."
          python dashboard_api.py
          echo "âœ… Dashboard data generated"

      - name: Check for changes
        id: changes
        run: |
          if git diff --quiet 
  docs/api/dashboard-data.json; then
            echo "changed=false" >> $GITHUB_OUTPUT
          else
            echo "changed=true" >> $GITHUB_OUTPUT
          fi

      - name: Commit and push changes
        if: steps.changes.outputs.changed == 'true'
        run: |
          git config --local user.email 
  "dashboard@alpaca-trading.com"
          git config --local user.name "Dashboard 
  Auto-Update"
          git add docs/api/dashboard-data.json
          git commit -m "ğŸ“Š Auto-update dashboard data 
  $(date -u '+%Y-%m-%d %H:%M UTC')"
          git push

      - name: Log update status
        run: |
          if [ "${{ steps.changes.outputs.changed }}" 
  == "true" ]; then
            echo "âœ… Dashboard data updated and pushed 
  to GitHub Pages"
          else
            echo "â„¹ï¸ No changes to dashboard data"
          fi
